{"version":3,"file":"49.d9dbe19e.iframe.bundle.js","mappings":";;;;;;;;AAkBA;;;;;;;;;;ACmBA;;;ACpBA;;ACSA","sources":["webpack://@osuresearch/annotator/./src/components/ActionsSidebar/ActionsSidebar.tsx","webpack://@osuresearch/annotator/./src/components/Thread/EditableMessage.tsx","webpack://@osuresearch/annotator/./src/components/Thread/StartReply.tsx","webpack://@osuresearch/annotator/./src/components/AnchoredContainer/AnchoredContainer.tsx"],"sourcesContent":["import React, { useEffect, useState } from 'react';\nimport { useAnnotationsContext } from '../../hooks/useAnnotationsContext';\nimport styled from 'styled-components';\nimport { AnnotationSelection, useAnnotationPicker } from '../../hooks/useAnnotationPicker';\nimport { useFocusWithin } from 'react-aria';\nimport { IconButton, Tooltip } from '@osuresearch/ui';\nimport { AnnotationMotivation } from '../../types';\n\nconst Panel = styled.div`\n  position: absolute;\n  right: 0;\n  transition: 200ms;\n  background: var(--rui-light);\n  border: 2px solid var(--rui-light-shade);\n  flex-direction: column;\n  margin-right: 4px;\n`;\n\nexport function ActionsSidebar() {\n  const { selected } = useAnnotationPicker();\n  const { createThread } = useAnnotationsContext();\n  const [isFocusWithin, onFocusWithinChange] = useState(false);\n  const { focusWithinProps } = useFocusWithin({\n    onFocusWithinChange\n  });\n\n  const [top, setTop] = useState(0);\n  const [prev, setPrev] = useState<AnnotationSelection>();\n  const [active, setActive] = useState<AnnotationSelection>();\n\n  const startThread = (motivation: AnnotationMotivation) => {\n    if (!active) {\n      return;\n    }\n\n    const thread = createThread(motivation, {\n      type: 'FragmentSelector',\n      value: active.targetField,\n\n      // If we have a text range selected, use that as refinement.\n      refinedBy: (active.start && active.end)\n        ? {\n            type: 'TextPositionSelector',\n            start: active.start,\n            end: active.end\n        }\n        : undefined\n    });\n  };\n\n  // TODO: All this useEffect stuff should be encapsulated elsewhere\n  // to a reusable tracker of what's selected and what isn't. It\n  // doesn't need to be in this component in particular.\n  useEffect(() => {\n    if (selected) {\n      setTop(selected.top);\n    }\n\n    if (selected) {\n      setPrev(selected);\n    }\n  }, [selected]);\n\n  useEffect(() => {\n    if (isFocusWithin) {\n      setActive(prev);\n    } else {\n      setActive(selected);\n    }\n  }, [isFocusWithin, prev, selected]);\n\n  return (\n    <Panel\n      style={{\n        top: top - 16,\n        right: 4,\n        display: active ? 'flex' : 'none',\n        zIndex: 50\n      }}\n      {...focusWithinProps}\n    >\n      <Tooltip contentSlot=\"Ask a question\">\n        <IconButton\n          name=\"questioningComment\"\n          label=\"Ask a question\"\n          size={24}\n          onPress={() => startThread('questioning')}\n        />\n      </Tooltip>\n\n      <Tooltip contentSlot=\"Add a comment\">\n        <IconButton\n          name=\"addComment\"\n          label=\"Add a comment\"\n          size={24}\n          onPress={() => startThread('commenting')}\n        />\n      </Tooltip>\n\n      <Tooltip contentSlot=\"Make a suggestion\">\n        <IconButton\n          name=\"suggestionComment\"\n          label=\"Make a suggestion\"\n          size={24}\n          onPress={() => startThread('commenting')}\n        />\n      </Tooltip>\n    </Panel>\n  );\n}\n","import React, { useEffect, useContext } from 'react';\nimport { Button, Group, Stack, Text } from '@osuresearch/ui';\nimport { useFocusWithin } from 'react-aria';\nimport { EditorContent, useEditor } from '@tiptap/react';\nimport Placeholder from '@tiptap/extension-placeholder';\nimport StarterKit from '@tiptap/starter-kit';\nimport { getHotkeyHandler } from '@mantine/hooks';\nimport styled from 'styled-components';\nimport { EditorsContext } from '../../hooks/useEditors';\n\nexport type EditableMessageProps = {\n  defaultValue: string;\n  placeholder?: string;\n  autosave?: boolean;\n  onSave: (value: string) => void;\n  onCancel: () => void;\n};\n\nconst EditorStyles = styled.div`\n\n  .ProseMirror {\n    border: 1px solid var(--rui-light);\n    padding: var(--rui-spacing-xs);\n  }\n  .ProseMirror-focused {\n    outline: none;\n    border: 1px solid var(--rui-light);\n  }\n`;\n\n/**\n * Rich text editor with a save/cancel button visible on mount.\n *\n * a11y\n * - Focuses on the text input on mount\n * - Traps keyboard focus until closed\n */\nexport function EditableMessage({\n  defaultValue,\n  placeholder,\n  autosave = false,\n  onSave,\n  onCancel\n}: EditableMessageProps) {\n  const { setActiveEditor } = useContext(EditorsContext);\n\n  const { focusWithinProps } = useFocusWithin({\n    onBlurWithin: (e) => {\n      // if (autosave) {\n      //   handleSave();\n      // } else {\n      //   handleCancel();\n      // }\n    }\n  });\n\n  const editor = useEditor(\n    {\n      content: defaultValue,\n      extensions: [\n        StarterKit,\n        Placeholder.configure({\n          placeholder\n        })\n      ]\n    },\n    []\n  );\n\n  const handleSave = () => {\n    if (!editor) {\n      return;\n    }\n\n    const textContent = editor.getText();\n    const content = editor.getHTML();\n\n    editor.chain().clearContent().blur().run();\n\n    setActiveEditor(false);\n    if (textContent.length > 0) {\n      onSave(content);\n    }\n    else {\n      onCancel();\n    }\n  };\n\n  const handleCancel = () => {\n    if (!editor) {\n      return;\n    }\n\n    editor.chain().clearContent().blur().run();\n\n    setActiveEditor(false);\n    onCancel();\n  };\n\n  useEffect(() => {\n    if (editor) {\n      editor.commands.focus('end');\n    }\n\n    setActiveEditor(true);\n\n    return () => setActiveEditor(false);\n  }, [editor]);\n\n  return (\n    <Stack align=\"stretch\" fs=\"sm\">\n      <EditorStyles>\n        <EditorContent\n          editor={editor}\n          onKeyDown={getHotkeyHandler([['mod+Enter', handleSave]])}\n        />\n      </EditorStyles>\n\n      <Group justify=\"end\" align=\"center\">\n        <Text fs=\"xs\" c=\"dark\">Tip: Press Ctrl+Enter to save.</Text>\n        <Button variant=\"subtle\" onPress={handleCancel}>Cancel</Button>\n        <Button onPress={handleSave}>Save</Button>\n      </Group>\n    </Stack>\n  );\n}\n","import React, { useState, useContext } from 'react';\nimport { Group, Stack, UnstyledButton } from '@osuresearch/ui';\nimport styled from 'styled-components';\nimport { useThread } from '../../hooks/useThread';\nimport { EditorsContext } from '../../hooks/useEditors';\nimport { EditableMessage } from './EditableMessage';\nimport { Annotation } from '../../types';\n\nexport type StartReplyProps = {\n  thread: Annotation;\n};\n\nconst Root = styled.div`\n  border: 1px solid var(--rui-light);\n  padding: var(--rui-spacing-xs);\n`;\n\nexport function StartReply({ thread }: StartReplyProps) {\n  const { hasActiveEditor } = useContext(EditorsContext);\n  const [active, setActive] = useState(false);\n  const { addReply } = useThread(thread.id);\n\n  const onSave = (message: string) => {\n    addReply(message);\n    setActive(false);\n  };\n\n  const onCancel = () => {\n    setActive(false);\n  }\n\n  const onReply = () => {\n    setActive(true);\n  }\n\n  return (\n    <Stack align=\"stretch\" fs=\"sm\">\n      {!active && (\n        <UnstyledButton isDisabled={hasActiveEditor} as={Root} onPress={onReply} c=\"dark\">\n          <Group>\n            {hasActiveEditor\n              ? 'Another comment is in progress.'\n              : 'Reply'\n            }</Group>\n        </UnstyledButton>\n      )}\n\n      {active && (\n        <EditableMessage\n          placeholder=\"Reply\"\n          onSave={onSave}\n          onCancel={onCancel}\n          defaultValue=\"\"\n        />\n      )}\n    </Stack>\n  );\n}\n","import React, { useEffect } from \"react\";\nimport styled from \"styled-components\";\nimport { IconButton } from \"@osuresearch/ui\";\nimport { useCellListItem } from \"../../hooks/useCellListItem\";\nimport { Anchor } from '../../types';\nimport { useElementSize } from \"../../hooks/useElementSize\";\n\nexport type AnchoredContainerProps = {\n  id: string\n  anchor?: Anchor\n  focused: boolean\n  children: React.ReactNode\n\n  /**\n   * Additional spacing between adjacent containers\n   */\n  gap: number;\n}\n\nconst AnimatedContainer = styled.div`\n  transition: 200ms;\n`;\n\n/**\n * Responsible for keeping body content aligned with a target anchor.\n */\nexport function AnchoredContainer({ id, anchor, focused, gap, children }: AnchoredContainerProps) {\n  const anchorPos = anchor?.target || { y: 0, x: 0, width: 0, height: 0 };\n\n  const { ref, height } = useElementSize();\n  const heightWithGap = height + gap;\n\n  const { item, update, focus } = useCellListItem(id, anchorPos.y);\n\n  useEffect(() => {\n    if (!item) {\n      return;\n    }\n\n    const updated = {...item};\n\n    if (heightWithGap !== item.height) {\n      updated.height = heightWithGap;\n      update(updated);\n    }\n\n    if (focused) {\n      focus();\n    }\n  }, [item, id, anchorPos, heightWithGap, focused]);\n\n  // TODO: This is a hack to stop the fly-in focus event that happens.\n  // Will cause issues if something is shifted to cell 0.\n  if (item?.cell === 0) {\n    return null;\n  }\n\n  return (\n    <>\n    <IconButton size={20} label=\"Comments\" name=\"comment\" style={{\n      position: 'absolute',\n      transform: `translateY(${item?.anchorCell ?? 0}px) translateX(-28px)`,\n      color: focused ? '#a76f09' : '#d3b172',\n      zIndex: focused ? 40 : undefined,\n    }} />\n\n    {/* <div style={{\n      position: 'absolute',\n      width: 1000,\n      height: 1,\n      backgroundColor: 'red',\n      top: item?.anchorCell,\n      left: 0,\n      marginLeft: -1000,\n      zIndex: 9999,\n    }} /> */}\n\n    <AnimatedContainer ref={ref} style={{\n      position: 'absolute',\n      transform: item?.cell\n        ? `translateY(${item?.cell ?? 0}px) translateX(${focused ? -12 :0}px)`\n        : undefined,\n    }}>\n      {children}\n    </AnimatedContainer>\n    </>\n  );\n}\n"],"names":[],"sourceRoot":""}