"use strict";(self.webpackChunk_osuresearch_annotator=self.webpackChunk_osuresearch_annotator||[]).push([[816],{"./src/components/PDFDocument/PDFDocument.stories.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{Simple:()=>Simple,__namedExportsOrder:()=>__namedExportsOrder,default:()=>PDFDocument_stories});var react=__webpack_require__("./node_modules/react/index.js"),index_module=__webpack_require__("./node_modules/@osuresearch/ui/dist/index.module.js"),Annotations2=__webpack_require__("./src/components/Annotations/Annotations2.tsx"),useAnnotationsContext=__webpack_require__("./src/hooks/useAnnotationsContext.ts");class AdobeDCDocument{constructor(clientId,divId){this.adobeDCView=new window.AdobeDC.View({clientId,divId,sendAutoPDFAnalytics:!1}),this.handlers=new Map}destroy(){console.log("AdobeDCDocument::destroy")}preview(url,filename,id){this.adobeDCView.previewFile({content:{location:{url}},metaData:{id,fileName:filename}},{embedMode:"FULL_WINDOW",showAnnotationTools:!0,showDownloadPDF:!1,enableAnnotationAPIs:!0,enableFormFilling:!1}).then((viewer=>{viewer.getAnnotationManager().then((manager=>{this.connectToManager(manager)}))}))}connectToManager(manager){this.annotationManager=manager,manager.setConfig({showCommentsPanel:!1}),manager.registerEventListener(this.handleAnnotationEvent.bind(this))}handleAnnotationEvent(event){console.log(event.type,event.data);const type=event.type,annotation=event.data,listeners=this.handlers.get(type);listeners&&listeners.forEach((e=>e(annotation)))}registerHandler(event,handler){const handlers=this.handlers.get(event);handlers?handlers.push(handler):this.handlers.set(event,[handler])}unregisterHandler(event,handler){const handlers=this.handlers.get(event);handlers?this.handlers.set(event,handlers.filter((e=>e!==handler))):console.warn("Handler is not registered",event,handler)}async deleteAnnotation(id){try{await this.annotationManager.deleteAnnotations({annotationIds:[id]})}catch(e){console.error("deleteAnnotation error: ",id,e)}}async addAnnotations(annotations){await this.annotationManager.addAnnotations(annotations)}async getAnnotations(){return await this.annotationManager.getAnnotations()}async getAnnotationIds(){return(await this.getAnnotations()).map((a=>a.id))}}var jsx_runtime=__webpack_require__("./node_modules/react/jsx-runtime.js");function PDFDocument({clientId,url,filename}){const[doc,setDoc]=(0,react.useState)(),id="adobe-dc-view",ref=(0,react.useRef)(null),{annotations,focus,clearFocus,create,patch}=(0,useAnnotationsContext.i)();return(0,react.useEffect)((()=>{const script=document.createElement("script");let doc;return script.src="https://documentservices.adobe.com/view-sdk/viewer.js",document.body.appendChild(script),document.addEventListener("adobe_dc_view_sdk.ready",(()=>{doc=new AdobeDCDocument(clientId,id),setDoc(doc)})),()=>doc?.destroy()}),[clientId,id]),(0,react.useEffect)((()=>{doc&&ref.current&&doc.preview(url,filename,"77c6fa5d-6d74-4104-8349-657c8411a834")}),[doc,url,filename]),(0,react.useEffect)((()=>{if(!doc)return;const onAdded=annotation=>{create(annotation.target.source,annotation.motivation,annotation.target.selector,annotation.id)},onRemoved=annotation=>{patch(annotation.id,(prev=>({...prev,deleted:!0,recoverable:!0})))},onUpdated=annotation=>{patch(annotation.id,(prev=>({...prev,target:annotation.target})))},onClicked=annotation=>{focus(annotation.id)};return doc.registerHandler("ANNOTATION_ADDED",onAdded),doc.registerHandler("ANNOTATION_DELETED",onRemoved),doc.registerHandler("ANNOTATION_UPDATED",onUpdated),doc.registerHandler("ANNOTATION_CLICKED",onClicked),()=>{doc&&(doc.unregisterHandler("ANNOTATION_ADDED",onAdded),doc.unregisterHandler("ANNOTATION_DELETED",onRemoved),doc.unregisterHandler("ANNOTATION_UPDATED",onUpdated),doc.unregisterHandler("ANNOTATION_CLICKED",onClicked))}}),[doc,create,patch,focus]),(0,react.useEffect)((()=>{if(!doc||!annotations)return;doc?.getAnnotationIds()}),[doc,annotations]),(0,jsx_runtime.jsxs)(index_module.ZA,{h:"800px",grow:!0,children:[(0,jsx_runtime.jsx)("div",{ref,id,style:{width:800}}),(0,jsx_runtime.jsx)(index_module.Kq,{align:"stretch",maw:400,mah:"100%",style:{overflowY:"scroll",overflowX:"hidden"},children:(0,jsx_runtime.jsx)(Annotations2.u,{})})]})}PDFDocument.displayName="PDFDocument";try{PDFDocument.displayName="PDFDocument",PDFDocument.__docgenInfo={description:"Container for a reviewable PDF document.",displayName:"PDFDocument",props:{clientId:{defaultValue:null,description:"Adobe DC services client ID",name:"clientId",required:!0,type:{name:"string"}},url:{defaultValue:null,description:"URL to the PDF to render",name:"url",required:!0,type:{name:"string"}},filename:{defaultValue:null,description:"Human-readable filename of the PDF",name:"filename",required:!0,type:{name:"string"}}}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["src/components/PDFDocument/PDFDocument.tsx#PDFDocument"]={docgenInfo:PDFDocument.__docgenInfo,name:"PDFDocument",path:"src/components/PDFDocument/PDFDocument.tsx#PDFDocument"})}catch(__react_docgen_typescript_loader_error){}var AnnotationsProvider=__webpack_require__("./src/components/AnnotationsProvider/AnnotationsProvider.tsx");const PDFDocument_stories={title:"Components/PDFDocument",component:PDFDocument,argTypes:{}},Simple=args=>(0,jsx_runtime.jsx)(AnnotationsProvider.g,{children:(0,jsx_runtime.jsx)(PDFDocument,{...args})});Simple.displayName="Simple",Simple.args={clientId:"274aad324238449bb5170441fb0c2578",url:"https://documentservices.adobe.com/view-sdk-demo/PDFs/Bodea Brochure.pdf",filename:"Bodea Brochure.pdf"},Simple.parameters={...Simple.parameters,docs:{...Simple.parameters?.docs,source:{originalSource:"args => <AnnotationsProvider>\n    <PDFDocument {...args} />\n  </AnnotationsProvider>",...Simple.parameters?.docs?.source}}};const __namedExportsOrder=["Simple"]}}]);